---
title: "Task 3: Urchin Size Distributions"
author: "Thomas Lenihan"
date: "10/23/2021"
output: html_document
---
## Setup 

```{r setup, include=FALSE, warning = FALSE, message = FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse) 
library(here)
library(janitor) 
library(lubridate)
library(ggplot2)
library(kableExtra)
#attaching packages, setting up code chunk options

```

## Read in the data

```{r, message = FALSE}
urchins <- read_csv(here("data", "urchins.csv")) %>% 
  clean_names() #put titles in lower snake case

```

## Data visualization

### Size distribution histogram
Comparing the distribution of sizes between purple and red urchins
```{r}
ggplot(data = urchins,
       aes(x = size)) +
  geom_histogram(binwidth = 0.9, color = "black", fill = "white") + 
  # create a histogram with binwidth 1, to show the pattern of size distribution
  facet_grid(cols = vars(common_name))+ # break up size distributions by species (common+_name)
  labs(title = "Urchin Size Distributions By Species",
       x = "Size (cm)",
       y = "frequency") #add axis titles and labels

```
**Figure 1. Distribution of Urchin Sizes by Species.** This figure shows the differences in size distribution across populations of Purple and Red Urchins.Sizes are the diameter of each urchin in centimeters, and are rounded to the nearest 0.5 cm. 

### Urchin size statistics table

**Table 1. Descriptive Statistics of Urchin Sizes.** Sizes of Purple and Red Urchins were measured as the diameter of each individual in centimeters. mean, median, standard deviation, and sample size for each species are shown below. 
```{r}

urchin_size_stats <- urchins %>% #create a new data frame which will become the stats table
  group_by(common_name) %>% #organize by spp
  summarize(mean_mass_g = mean(size, na.rm = TRUE),
            median = median(size, na.rm = TRUE),
            sd = sd(size, na.rm = TRUE),
            sample_size = n()) #create summary statistics 

urchin_size_stats %>% 
  kable(col.names = c("Urchin Species", 
                      "Mean size (cm)", 
                      "Median size (cm)",
                      "Standard Deviation (cm)",
                      "Sample size (n)")) %>% 
  kable_styling(full_width = FALSE)
#create a table to show summary stats using kableExtra
```

The above histograms and table describe the size distributions of Red and Purple Urchins, and show a few key differences between the populations. Red urchins appear to be normally distributed, while the size distribution of the Purple Urchins is positively skewed. The means of the two groups differ by 41%, or 2.3 cm.  The differences between the standard deviation of the Red Urchins (1.89 cm) and the Purple Urchins (1.18 cm) can be seen in the histogram: the size distribution of the Red Urchins has a larger spread than that of the Purple Urchins. 

## Table of Purple Urchin counts by site and year 

```{r}
purple_urchins <- urchins %>% 
  filter(common_name == "Purple Urchin") %>% #filter for "Purple Urchin"
  mutate(date = mdy(date)) %>% # create date class
  mutate(year = year(date)) %>% # create a column with only year
  mutate(site_full = case_when(# Add a new column site_full, which contains... 
    site == "NAPL" ~ "Naples Reef", # "Naples Reef" if site NAPL
    site == "AQUE" ~ "Arroyo Quemado Reef", # "Arroyo Quemado Reef" if site is AQUE
    site == "CARP" ~ "Carpenteria Reef", # "Carpenteria Reef" if site is CARP
    site == "IVEE"~ "Isla Vista Reef", # "Isla Vista Reef" if site is IVEE
    site == "MOHK" ~ "Mohawk Reef", # "Mohawk Reef" if site is MOHK
  )
  )
purple_urchins_table <- purple_urchins %>% 
  group_by(year, site_full) %>% #create a table, group by year and site
  summarize(sample_size = n())

```

## Plot of Purple Urchin site populations over time

```{r}
ggplot(data = purple_urchins_table, 
       aes(x = year, y = sample_size)) +
  geom_col( fill = "lavender", color = "black", binwidth = 2 ) +
  facet_grid(cols = vars(site_full)) 
  
```

